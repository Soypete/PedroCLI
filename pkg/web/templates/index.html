{{template "base" .}}

{{define "content"}}
<div class="max-w-6xl mx-auto">
    <!-- Mode switcher -->
    <div class="mb-4 sm:mb-6">
        <div class="inline-flex rounded-lg border border-gray-200 bg-white p-1">
            <button id="mode-coding" onclick="switchMode('coding')"
                    class="mode-btn px-4 py-2 text-sm font-medium rounded-md transition-colors bg-blue-600 text-white">
                Coding Tools
            </button>
            <button id="mode-podcast" onclick="switchMode('podcast')"
                    class="mode-btn px-4 py-2 text-sm font-medium rounded-md transition-colors text-gray-700 hover:bg-gray-100">
                Podcast Tools
            </button>
        </div>
    </div>

    <!-- Page header -->
    <div class="mb-6 sm:mb-8">
        <h1 id="page-title" class="text-2xl sm:text-3xl font-bold text-gray-900">Coding Jobs</h1>
        <p id="page-subtitle" class="mt-1 sm:mt-2 text-sm sm:text-base text-gray-600">Create and manage autonomous coding tasks</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8">
        <!-- Job creation form (left column on desktop, top on mobile) -->
        <div class="lg:col-span-1 order-1 lg:order-1">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6 lg:sticky lg:top-4">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Create New Job</h2>

                <form id="create-job-form"
                      hx-post="/api/jobs"
                      hx-target="#job-list"
                      hx-swap="afterbegin"
                      class="space-y-4">

                    <!-- Job type selector -->
                    <div>
                        <label for="type" class="block text-sm font-medium text-gray-700 mb-2">
                            Job Type
                        </label>
                        <!-- Coding mode job types -->
                        <select id="type"
                                name="type"
                                class="coding-mode-only w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                onchange="updateFormFields(this.value)">
                            <option value="builder">Builder - Build new features</option>
                            <option value="debugger">Debugger - Fix issues</option>
                            <option value="reviewer">Reviewer - Review code</option>
                            <option value="triager">Triager - Diagnose issues</option>
                        </select>
                        <!-- Podcast mode job types -->
                        <select id="type-podcast"
                                name="type"
                                class="podcast-mode-only hidden w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                onchange="updateFormFields(this.value)">
                            <option value="create_podcast_script">Create Script - Generate episode scripts</option>
                            <option value="add_notion_link">Add Link - Add article/news to review</option>
                            <option value="add_guest">Add Guest - Add guest information</option>
                            <option value="create_episode_outline">Create Outline - Generate episode structure</option>
                            <option value="review_news_summary">Review News - Summarize news for prep</option>
                        </select>
                    </div>

                    <!-- Description field (for builder, triager) -->
                    <div id="description-field">
                        <div class="flex items-center justify-between mb-2">
                            <label for="description" class="block text-sm font-medium text-gray-700">
                                Description
                            </label>
                            <!-- Voice input button -->
                            <button type="button"
                                    id="voice-btn"
                                    onclick="VoiceRecorder.toggle('description')"
                                    class="inline-flex items-center px-3 py-1 text-sm bg-gray-200 hover:bg-gray-300 rounded-md transition-colors">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"/>
                                    <path d="M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"/>
                                </svg>
                                <span class="ml-2">Voice</span>
                            </button>
                        </div>
                        <textarea id="description"
                                  name="description"
                                  rows="4"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                  placeholder="Describe what you want to build..."></textarea>
                    </div>

                    <!-- Issue field (optional for builder) -->
                    <div id="issue-field">
                        <label for="issue" class="block text-sm font-medium text-gray-700 mb-2">
                            Issue # (optional)
                        </label>
                        <input type="text"
                               id="issue"
                               name="issue"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                               placeholder="GH-123">
                    </div>

                    <!-- Symptoms field (for debugger) -->
                    <div id="symptoms-field" class="hidden">
                        <label for="symptoms" class="block text-sm font-medium text-gray-700 mb-2">
                            Symptoms
                        </label>
                        <textarea id="symptoms"
                                  name="symptoms"
                                  rows="3"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                  placeholder="Describe the problem..."></textarea>
                    </div>

                    <!-- Logs field (for debugger) -->
                    <div id="logs-field" class="hidden">
                        <label for="logs" class="block text-sm font-medium text-gray-700 mb-2">
                            Logs (optional)
                        </label>
                        <textarea id="logs"
                                  name="logs"
                                  rows="3"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                  placeholder="Paste error logs..."></textarea>
                    </div>

                    <!-- Branch field (for reviewer) -->
                    <div id="branch-field" class="hidden">
                        <label for="branch" class="block text-sm font-medium text-gray-700 mb-2">
                            Branch
                        </label>
                        <input type="text"
                               id="branch"
                               name="branch"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                               placeholder="feature/my-feature">
                    </div>

                    <!-- Podcast: Topic field -->
                    <div id="topic-field" class="hidden">
                        <label for="topic" class="block text-sm font-medium text-gray-700 mb-2">
                            Episode Topic
                        </label>
                        <textarea id="topic"
                                  name="topic"
                                  rows="3"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                  placeholder="What is the episode about?"></textarea>
                    </div>

                    <!-- Podcast: Notes field -->
                    <div id="notes-field" class="hidden">
                        <label for="notes" class="block text-sm font-medium text-gray-700 mb-2">
                            Notes (optional)
                        </label>
                        <textarea id="notes"
                                  name="notes"
                                  rows="2"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                  placeholder="Additional notes or context..."></textarea>
                    </div>

                    <!-- Podcast: URL field -->
                    <div id="url-field" class="hidden">
                        <label for="url" class="block text-sm font-medium text-gray-700 mb-2">
                            URL
                        </label>
                        <input type="url"
                               id="url"
                               name="url"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                               placeholder="https://example.com/article">
                    </div>

                    <!-- Podcast: Guest Name field -->
                    <div id="guest-name-field" class="hidden">
                        <label for="guest-name" class="block text-sm font-medium text-gray-700 mb-2">
                            Guest Name
                        </label>
                        <input type="text"
                               id="guest-name"
                               name="name"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                               placeholder="Jane Smith">
                    </div>

                    <!-- Podcast: Guest Bio field -->
                    <div id="guest-bio-field" class="hidden">
                        <label for="guest-bio" class="block text-sm font-medium text-gray-700 mb-2">
                            Guest Bio
                        </label>
                        <textarea id="guest-bio"
                                  name="bio"
                                  rows="2"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                  placeholder="Brief bio or description..."></textarea>
                    </div>

                    <!-- Podcast: Guest Email field -->
                    <div id="guest-email-field" class="hidden">
                        <label for="guest-email" class="block text-sm font-medium text-gray-700 mb-2">
                            Guest Email (optional)
                        </label>
                        <input type="email"
                               id="guest-email"
                               name="email"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                               placeholder="guest@example.com">
                    </div>

                    <!-- Podcast: Focus Topic field -->
                    <div id="focus-topic-field" class="hidden">
                        <label for="focus-topic" class="block text-sm font-medium text-gray-700 mb-2">
                            Focus Topic (optional)
                        </label>
                        <input type="text"
                               id="focus-topic"
                               name="focus_topic"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                               placeholder="AI, machine learning, etc.">
                    </div>

                    <!-- Submit button (larger touch target on mobile) -->
                    <button type="submit"
                            class="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors text-base sm:text-sm">
                        Create Job
                    </button>
                </form>
            </div>
        </div>

        <!-- Job list (right column on desktop, below form on mobile) -->
        <div class="lg:col-span-2 order-2 lg:order-2">
            <div class="flex items-center justify-between mb-3 sm:mb-4">
                <h2 class="text-lg sm:text-xl font-semibold text-gray-900">Active Jobs</h2>
                <button hx-get="/api/jobs"
                        hx-target="#job-list"
                        hx-swap="innerHTML"
                        class="text-sm text-blue-600 hover:text-blue-700 py-2 px-3">
                    Refresh
                </button>
            </div>

            <!-- Job list (auto-refresh will be added dynamically if jobs exist) -->
            <div id="job-list"
                 hx-get="/api/jobs"
                 hx-trigger="load"
                 hx-swap="innerHTML"
                 class="space-y-4">
                <div class="text-center py-12 text-gray-500">
                    Loading jobs...
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Current mode (coding or podcast)
let currentMode = localStorage.getItem('pedrocli_mode') || 'coding';

// Initialize mode on page load
document.addEventListener('DOMContentLoaded', function() {
    switchMode(currentMode, false);
});

// Switch between coding and podcast modes
function switchMode(mode, save = true) {
    currentMode = mode;
    if (save) {
        localStorage.setItem('pedrocli_mode', mode);
    }

    // Update button styles
    const codingBtn = document.getElementById('mode-coding');
    const podcastBtn = document.getElementById('mode-podcast');

    if (mode === 'coding') {
        codingBtn.classList.add('bg-blue-600', 'text-white');
        codingBtn.classList.remove('text-gray-700', 'hover:bg-gray-100');
        podcastBtn.classList.remove('bg-blue-600', 'text-white');
        podcastBtn.classList.add('text-gray-700', 'hover:bg-gray-100');

        // Update header
        document.getElementById('page-title').textContent = 'Coding Jobs';
        document.getElementById('page-subtitle').textContent = 'Create and manage autonomous coding tasks';

        // Show/hide selectors
        document.getElementById('type').classList.remove('hidden');
        document.getElementById('type-podcast').classList.add('hidden');
        document.getElementById('type').name = 'type';
        document.getElementById('type-podcast').name = '';

        // Show coding mode elements
        document.querySelectorAll('.coding-mode-only').forEach(el => el.classList.remove('hidden'));
        document.querySelectorAll('.podcast-mode-only').forEach(el => el.classList.add('hidden'));

        // Update form fields for current selection
        updateFormFields(document.getElementById('type').value);
    } else {
        podcastBtn.classList.add('bg-blue-600', 'text-white');
        podcastBtn.classList.remove('text-gray-700', 'hover:bg-gray-100');
        codingBtn.classList.remove('bg-blue-600', 'text-white');
        codingBtn.classList.add('text-gray-700', 'hover:bg-gray-100');

        // Update header
        document.getElementById('page-title').textContent = 'Podcast Tools';
        document.getElementById('page-subtitle').textContent = 'Manage content for Domesticating AI podcast';

        // Show/hide selectors
        document.getElementById('type').classList.add('hidden');
        document.getElementById('type-podcast').classList.remove('hidden');
        document.getElementById('type').name = '';
        document.getElementById('type-podcast').name = 'type';

        // Show podcast mode elements
        document.querySelectorAll('.coding-mode-only').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.podcast-mode-only').forEach(el => el.classList.remove('hidden'));

        // Update form fields for current selection
        updateFormFields(document.getElementById('type-podcast').value);
    }
}

// Update form fields based on job type
function updateFormFields(type) {
    // Hide all optional fields
    const fields = [
        'description-field', 'issue-field', 'symptoms-field', 'logs-field', 'branch-field',
        'topic-field', 'notes-field', 'url-field', 'guest-name-field', 'guest-bio-field',
        'guest-email-field', 'focus-topic-field'
    ];
    fields.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.add('hidden');
    });

    // Show relevant fields based on type
    switch(type) {
        // Coding mode types
        case 'builder':
            document.getElementById('description-field').classList.remove('hidden');
            document.getElementById('issue-field').classList.remove('hidden');
            break;
        case 'debugger':
            document.getElementById('symptoms-field').classList.remove('hidden');
            document.getElementById('logs-field').classList.remove('hidden');
            break;
        case 'reviewer':
            document.getElementById('branch-field').classList.remove('hidden');
            break;
        case 'triager':
            document.getElementById('description-field').classList.remove('hidden');
            break;

        // Podcast mode types
        case 'create_podcast_script':
            document.getElementById('topic-field').classList.remove('hidden');
            document.getElementById('notes-field').classList.remove('hidden');
            break;
        case 'add_notion_link':
            document.getElementById('url-field').classList.remove('hidden');
            document.getElementById('notes-field').classList.remove('hidden');
            break;
        case 'add_guest':
            document.getElementById('guest-name-field').classList.remove('hidden');
            document.getElementById('guest-bio-field').classList.remove('hidden');
            document.getElementById('guest-email-field').classList.remove('hidden');
            break;
        case 'create_episode_outline':
            document.getElementById('topic-field').classList.remove('hidden');
            document.getElementById('notes-field').classList.remove('hidden');
            break;
        case 'review_news_summary':
            document.getElementById('focus-topic-field').classList.remove('hidden');
            break;
    }
}
</script>
{{end}}
